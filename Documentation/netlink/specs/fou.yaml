name: fou

protocol: genetlink-c

description: |
  Foo-over-UDP.

c-family-name: fou-genl-name
c-version-name: fou-genl-version
max-by-define: true

definitions:
  -
    type: enum
    name: encap_type
    name-prefix: fou-encap-
    enum-name:
    entries: [ unspec, direct, gue ]

attribute-sets:
  -
    name: fou
    name-prefix: fou-attr-
    attributes:
      -
        name: unspec
        type: unused
      -
        name: port
        type: u16
      -
        name: af
        type: u8
      -
        name: ipproto
        type: u8
      -
        name: type
        type: u8
      -
        name: remcsum_nopartial
        type: flag
      -
        name: local_v4
        type: u32
      -
        name: local_v6
        type: binary
        len: 16
      -
        name: peer_v4
        type: u32
      -
        name: peer_v6
        type: binary
        len: 16
      -
        name: peer_port
        type: u16
      -
        name: ifindex
        type: s32

operations:
  list:
    -
      name: unspec
      description: unused

    -
      name: add
      description: Add port.
      attribute-set: fou

      dont-validate: [ strict, dump ]
      flags: [ admin-perm ]

      do:
        request: &all_attrs
          attributes:
            - port
            - ipproto
            - type
            - remcsum_nopartial
            - local_v4
            - peer_v4
            - local_v6
            - peer_v6
            - peer_port
            - ifindex

    -
      name: del
      description: Delete port.
      attribute-set: fou

      dont-validate: [ strict, dump ]
      flags: [ admin-perm ]

      do:
        request:  &select_attrs
          attributes:
          - af
          - ifindex
          - port
          - peer_port
          - local_v4
          - peer_v4
          - local_v6
          - peer_v6

    -
      name: get
      description: Get tunnel info.
      attribute-set: fou
      dont-validate: [ strict, dump ]

      do:
        request: *select_attrs
        reply: *all_attrs

      dump:
        reply: *all_attrs
