# SPDX-License-Identifier: BSD-3-Clause

name: ethtool

description: |
  Ethernet device configuration interface.

attr-cnt-suffix: CNT

attribute-sets:
  -
    name: header
    attributes:
      -
        name: dev_index
        value: 1
        type: u32
      -
        name: dev_name
        type: nul-string
        len: ALTIFNAMSIZ - 1
      -
        name: flags
        type: u32
  -
    name: channels
    attributes:
      -
        name: header
        value: 1
        type: nest
        nested-attributes: header
      -
        name: rx_max
        type: u32
      -
        name: tx_max
        type: u32
      -
        name: other_max
        type: u32
      -
        name: combined_max
        type: u32
      -
        name: rx_count
        type: u32
      -
        name: tx_count
        type: u32
      -
        name: other_count
        type: u32
      -
        name: combined_count
        type: u32

headers:
  user: linux/if.h
  uapi: linux/ethtool_netlink.h

operations:
  name-prefix: ETHTOOL_MSG_
  async-prefix: ETHTOOL_MSG_
  list:
    -
      name: channels_get
      value: 17
      description: Get current and max supported number of channels.
      attribute-set: channels
      do:
        request:
          attributes:
            - header
        reply: &channel_reply
          attributes:
            - header
            - rx_max
            - tx_max
            - other_max
            - combined_max
            - rx_count
            - tx_count
            - other_count
            - combined_count
      dump:
        reply: *channel_reply

    -
      name: channels_ntf
      description: Notification for device changing its number of channels.
      notify: channels_get
      mcgrp: monitor

    -
      name: channels_set
      description: Set number of channels.
      attribute-set: channels
      do:
        request:
          attributes:
            - header
            - rx_count
            - tx_count
            - other_count
            - combined_count

mcast-groups:
  name-prefix: ETHTOOL_MCGRP_
  name-suffix: _NAME
  list:
    -
      name: monitor
