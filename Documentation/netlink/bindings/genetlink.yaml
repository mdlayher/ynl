name: genlctrl

description: |
  Generic netlink control protocol. Interface to query information about
  generic netlink families registered in the kernel - their names, ids,
  accepted messages and attributes.

headers:
  user: linux/genetlink.h
  kernel: linux/genetlink.h

attributes:
  spaces:
    main:
      name-prefix: CTRL_ATTR_
      list:
        family_id: &family_id
          type: u16
          decription: |
            Numerical identifier of the family.
        family_name: &family_name
          type: nul-string
          len: GENL_NAMSIZ - 1
          description: |
            String identifier of the family. Guaranteed to be unique.
        version: &version
          type: u32
        hdrsize: &hdrsize
          type: u32
        maxattr: &maxattr
          type: u32
        ops: &ops
          type: array-nest
          nested-attributes: operation
        op: &op
          type: u32
        op_policy:
          type: nest-type-value
          type-value: [ cmd ]
          nested-attributes: policy
        policy:
          type: nest-type-value
          type-value: [ current_policy_idx, attr_idx ]
          nested-attributes: nl-policy

    operation:
      name-prefix: CTRL_ATTR_OP_
      list:
        id: &op_id
          type: u32
        flags: &op_flags
          type: u32

    policy:
      name-prefix: CTRL_ATTR_POLICY_
      list:
        do:
          type: u32
        dump:
          type: u32

    nl-policy:
      name-prefix: NL_POLICY_TYPE_ATTR_
      list:
        type:
          type: u32
          presence: always
        min_value_u:
          type: u64
        max_value_u:
          type: u64
        min_value_s:
          type: s64
        max_value_s:
          type: s64
        mask:
          type: u64
        min_length:
          type: u32
        max_length:
          type: u32
        policy_idx:
          type: u32
        policy_maxtype:
          type: u32
        bitfield32_mask:
          type: u32

operations:
  name-prefix: CTRL_CMD_
  list:
    getfamily:
      attribute-space: main
      dont-validate: [ strict, dump ]

      do:
        request:
          interfaces:
            by_id:
              - family_id
            by_name:
              - family_name
          attributes:
            - family_id
            - family_name
        reply: &getfamily-do-reply
          attributes:
            - family_id
            - family_name
            - version
            - hdrsize
            - maxattr
            - ops
      dump:
        reply: *getfamily-do-reply

    getpolicy:
      attribute-space: main

      dump:
        request:
          attributes:
            - family_id
            - family_name
            - op
        reply:
            - family_id
            - op_policy
            - policy
