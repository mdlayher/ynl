name: fou

description: |
  Foo-over-UDP.

headers:
  user: linux/fou.h
  kernel: linux/fou.h

constants:
  -
    type: family-name
  -
    type: version
  -
    type: enum
    name: encap_type
    value: [ UNSPEC, DIRECT, GUE ]

attributes:
  spaces:
    main:
      name-prefix: FOU_ATTR_
      list:
        unspec:
          type: skip
        port:
          type: u16
        af:
          type: u8
        ipproto:
          type: u8
        type:
          type: u8
        remcsum_nopartial:
          type: flag
        local_v4:
          type: u32
        local_v6:
          type: binary
          len: 16
        peer_v4:
          type: u32
        peer_v6:
          type: binary
          len: 16
        peer_port:
          type: u16
        ifindex:
          type: s32

operations:
  name-prefix: FOU_CMD_
  list:
    unspec:

    add:
      attribute-space: main

      dont-validate: [ strict, dump ]
      flags: [ admin_perm ]

      do:
        request: &all_attrs
          attributes:
            - port
            - ipproto
            - type
            - remcsum_nopartial
            - local_v4
            - peer_v4
            - local_v6
            - peer_v6
            - peer_port
            - ifindex

    del:
      attribute-space: main

      dont-validate: [ strict, dump ]
      flags: [ admin_perm ]

      do:
        request:  &select_attrs
          attributes:
          - af
          - ifindex
          - port
          - peer_port
          - local_v4
          - peer_v4
          - local_v6
          - peer_v6

    get:
      attribute-space: main
      dont-validate: [ strict, dump ]

      do:
        request: *select_attrs
        reply: *all_attrs

      dump:
        reply: *all_attrs
