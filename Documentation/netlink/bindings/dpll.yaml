name: dpll

description: |
  DPLL subsystem.

headers:
  uapi: linux/dpll.h

constants:
  -
    type: flags
    name: genl_get_flags
    value-prefix: DPLL_FLAG_
    values: [ sources, outputs, status ]

attribute-spaces:
  -
    name: main
    name-prefix: DPLLA_
    name-enum: genl_attr
    attributes:
      -
        name: unspec
        type: unused
      -
        name: device_id
        type: u32
      -
        name: device_name
        type: nul-string
        len: DPLL_NAME_LENGTH - 1
      -
        name: source
        type: multi-attr
        sub-type: nest
        nested-attributes: source
      -
        name: source_id
        type: u32
      -
        name: source_type
        type: u32
      -
        name: source_supported
        type: u32
      -
        name: output
        type: multi-attr
        sub-type: nest
        nested-attributes: output
      -
        name: output_id
        type: u32
      -
        name: output_type
        type: u32
      -
        name: output_supported
        type: u32
      -
        name: status
        type: u32
      -
        name: temp
        type: u32
      -
        name: lock_status
        type: u32
      -
        name: flags
        type: u32
        flags-mask: genl_get_flags
  -
    name: source
    subspace-of: main
    name-prefix: DPLLA_
    attributes:
      -
        name: output_id
        type: u32
      -
        name: output_type
        type: u32
      -
        name: output_supported
        type: multi-attr
        sub-type: u32
  -
    name: output
    subspace-of: main
    name-prefix: DPLLA_
    attributes:
      -
        name: source_id
        type: u32
      -
        name: source_type
        type: u32
      -
        name: source_supported
        type: multi-attr
        sub-type: u32

operations:
  name-prefix: DPLL_CMD_
  name-enum: genl_cmd
  list:
    -
      name: unspec
      description: unused

    -
      name: device_get
      description: Get the device info. TODO..
      attribute-space: main

      do:
        request:
          attributes:
            - device_id
            - device_name
            - flags

        reply:
          attributes:
            - device_id
            - device_name
            - source
            - output
            - status
            - temp
            - lock_status

    -
      name: set_source_type
      description: Set the source type. TODO..
      attribute-space: main
      flags: [ admin-perm ]

      do:
        request:
          attributes:
            - device_id
            - device_name
            - source_id
            - source_type

    -
      name: set_output_type
      description: Set the output type. TODO..
      attribute-space: main
      flags: [ admin-perm ]

      do:
        request:
          attributes:
            - device_id
            - device_name
            - output_id
            - output_type
